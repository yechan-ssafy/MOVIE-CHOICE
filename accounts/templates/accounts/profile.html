{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container">
  
    <h1 class="text-center font02">{{ person.username }}님의 프로필</h1>

  {% include 'accounts/_follow.html' %}

  <hr>

  <h2 class="font02">나의 활동</h2>
    <div class="card-group">
      <div class="card card-primary text-center">
        <img class="card-img-top" src="{% static 'icons/write.png' %}" alt="write">
        <div class="card-body">
          <div class="badge badge-primary badge-sm">REVIEW</div>
          <div class="card-title"><h4 class="font03">{{ person.username }}가 쓴 글</h4></div>
          {% for review in person.review_set.all %}
            <a href="{% url 'community:detail' review.pk %}"><p class="card-text">{{ review.title }}</p></a>
          {% endfor %}
        </div>
        <div class="card-footer">
        </div>
      </div>
      <div class="card card-primary text-center">
        <img class="card-img-top" src="{% static 'icons/comment.png' %}" alt="Comment">
        <div class="card-body">
          <div class="badge badge-primary badge-sm">COMMENT</div>
          <div class="card-title"><h4 class="font03">{{ person.username }}가 쓴 댓글</h4></div>
          {% for comment in person.comment_set.all %}
            <p class="">{{ comment.content }}</p>
          {% endfor %}
        </div>
        <div class="card-footer">
        </div>
      </div>
      <div class="card card-primary text-center">
        <img class="card-img-top" src="{% static 'icons/like.png' %}" alt="Like_Review">
        <div class="card-body">
          <div class="badge badge-primary badge-sm">REVIEW_LIKES</div>
          <div class="card-title"><h4 class="font03">{{ person.username }}가 좋아요한 글</h4></div>          
          {% for review in person.like_reviews.all %}
            <a href="{% url 'community:detail' review.pk %}"><p class="card-text">{{ review.title }}</p></a>
          {% endfor %}
        </div>
        <div class="card-footer">
        </div>
      </div>
      <div class="card card-primary text-center">
        <img class="card-img-top" src="{% static 'icons/camara.png' %}" alt="Like_Movie">
        <div class="card-body">
          <div class="badge badge-primary badge-sm">MOVIE_LIKES</div>
          <div class="card-title"><h4 class="font03">{{ person.username }}가 좋아요한 영화</h4></div>          
          {% for movie in person.like_movies.all %}
            <a href="{% url 'movies:detail' movie.id %}" class="card-text">{{ movie.title }}</a>
            <br>
          {% endfor %}
        </div>
        <div class="card-footer">
        </div>
      </div>
    </div>

  {% comment %} <h2>{{ person.username }}가 쓴 글</h2>
  {% for review in person.review_set.all %}
    <div>{{ review.title }}</div>
  {% endfor %}

  <hr>

  <h2>{{ person.username }}가 쓴 댓글</h2>
  {% for comment in person.comment_set.all %}
    <div>{{ comment.content }}</div>
  {% endfor %}
  
  <hr>

  <h2>{{ person.username }}가 좋아요한 글</h2>
  {% for review in person.like_reviews.all %}
    <div>{{ review.title }}</div>
  {% endfor %}

  <hr> {% endcomment %}

  <a href="{% url 'community:index' %}">[back]</a>
  {% endblock  %}

  {% block script %}
    <script>
      const followForm = document.querySelector('#follow-form')
      const userPk = followForm.dataset.userpk

      followForm.addEventListener('submit', function (e) {
        e.preventDefault()

        const API_URL = `/accounts/follow/${userPk}/`
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value
        const options = {headers: {'X-CSRFToken': csrfToken}}
        axios.post(API_URL, {}, options)
          .then(res => {
            const { is_follow, following_count, follower_count } = res.data

            const followBtn = document.querySelector('#follow-form > button')

            followBtn.classList.toggle('btn-primary')
            followBtn.classList.toggle('btn-secondary')

            followBtn.innerText = is_follow ? 'Unfollow' : 'Follow'

            const followCount = document.querySelector('#follow-count')
            followCount.innerText = `팔로잉 : ${following_count} / 팔로워 : ${follower_count}`
          })
          .catch(err => {
            console.error(err)
          })
      })
    </script>
</div>

{% block style %}
<style>
  .card {
    border:0;
  }


  /* card group aka PRIMARY */
  .card-group .card-primary:hover {
    box-shadow: 0 40px 60px -20px rgba(12, 5, 62, 0.15);
    z-index: 100;
  }
  .card-group .card-primary:hover .card-text{
    color: #4e22d0;
  }
  .card-group .card-primary .card-img-top{
    width:100px;
    height:100px;
    margin: 30px auto 32px;
  }
  .card-group .card-primary .card-body > .badge {
    margin-bottom: 24px;
  }
  .card-group .card-primary .card-body {
    padding: 0 32px;
  }
  .card-group .card-primary .card-title {
    color: #261c6a;
    font-size: 26px;
    line-height: 1.54;
    font-weight: 900;
    margin-bottom: 24px;
  }
  .card-group .card-primary .card-text {
    color: #261c6a;
    font-size: 16px;
    line-height: 1.5;
    font-weight: 400;
  }
  .card-group .card-primary .card-footer {
    padding: 48px 0 56px;
    background: transparent;
    border:0;
  }
  
  </style>
{% endblock %}
{% endblock %}
