{% extends 'base.html' %}

{% block content %}
<h1 class="text-center">{{ person.username }}님의 프로필</h1>

{% include 'accounts/_follow.html' %}

<hr>

<h2>{{ person.username }}가 쓴 글</h2>
{% for review in person.review_set.all %}
  <div>{{ review.title }}</div>
{% endfor %}

<hr>

<h2>{{ person.username }}가 쓴 댓글</h2>
{% for comment in person.comment_set.all %}
  <div>{{ comment.content }}</div>
{% endfor %}
 
<hr>

<h2>{{ person.username }}가 좋아요한 글</h2>
{% for review in person.like_reviews.all %}
  <div>{{ review.title }}</div>
{% endfor %}

<hr>

<a href="{% url 'community:index' %}">[back]</a>
{% endblock  %}

{% block script %}
  <script>
    const followForm = document.querySelector('#follow-form')
    const userPk = followForm.dataset.userpk

    followForm.addEventListener('submit', function (e) {
      e.preventDefault()

      const API_URL = `/accounts/follow/${userPk}/`
      const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value
      const options = {headers: {'X-CSRFToken': csrfToken}}
      axios.post(API_URL, {}, options)
        .then(res => {
          const { is_follow, following_count, follower_count } = res.data

          const followBtn = document.querySelector('#follow-form > button')

          followBtn.classList.toggle('btn-primary')
          followBtn.classList.toggle('btn-secondary')

          followBtn.innerText = is_follow ? 'Unfollow' : 'Follow'

          const followCount = document.querySelector('#follow-count')
          followCount.innerText = `팔로잉 : ${following_count} / 팔로워 : ${follower_count}`
        })
        .catch(err => {
          console.error(err)
        })
    })
  </script>
{% endblock %}
